!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@angular-extensions/elements",["exports","@angular/core","@angular/common"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self)["angular-extensions"]=e["angular-extensions"]||{},e["angular-extensions"].elements={}),e.ng.core,e.ng.common)}(this,(function(e,t,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function o(e,t,r,o){return new(r||(r=Promise))((function(n,i){function a(e){try{s(o.next(e))}catch(e){i(e)}}function l(e){try{s(o.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,l)}s((o=o.apply(e,t||[])).next())}))}function n(e,t){var r,o,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}}Object.create;Object.create;var i=new t.InjectionToken("LAZY_ELEMENT_CONFIGS"),a=new t.InjectionToken("LAZY_ELEMENT_ROOT_OPTIONS"),l=new t.InjectionToken("LAZY_ELEMENT_ROOT_GUARD"),s=new t.InjectionToken("LAZY_ELEMENTS_REGISTRY",{providedIn:"root",factory:function(){return new Map}});var c="@angular-extensions/elements";var d=function(){function e(e,t){this.registry=e,this.options=t,this.configs=[],t||(this.options={})}return e.prototype.addConfigs=function(e){var t=this;e.forEach((function(e){t.getElementConfig(e.tag)?console.warn(c+" - ElementConfig for tag '"+e.tag+"' was previously added, it will not be added multiple times, continue..."):(e.isAdded=!0,t.configs.push(e),(void 0!==e.preload?e.preload:t.options.preload)&&t.loadElement(e.url,e.tag,e.isModule,e.importMap,e.hooks))}))},e.prototype.getElementConfig=function(e){return this.configs.find((function(t){return t.tag===e}))},e.prototype.preload=function(e){var t=this,r=this.configs;e&&(r=this.configs.filter((function(t){return e.includes(t.tag)}))),r.forEach((function(e){return t.loadElement(e.url,e.tag,e.isModule,e.importMap,e.hooks)}))},e.prototype.loadElement=function(e,t,r,i,a){var l,s,d,u,p,m,f,h,y,v,g,E;return o(this,void 0,void 0,(function(){var o,w,L,R,C,T=this;return n(this,(function(n){switch(n.label){case 0:if(o=this.getElementConfig(t),null!=r||(r=null!==(l=null==o?void 0:o.isModule)&&void 0!==l?l:this.options.isModule),null!=i||(i=null!==(s=null==o?void 0:o.importMap)&&void 0!==s?s:this.options.importMap),!t)throw new Error(c+" - tag for '"+e+"' not found, the *axLazyElement has to be used on HTML element");if(!e){if(!(null==o?void 0:o.url)&&!i)throw new Error(c+" - url for <"+t+"> not found");e=i?t:o.url}return this.hasElement(e)?[3,3]:(w=this.addElement(e),L=null!==(p=null!==(d=null==a?void 0:a.beforeLoad)&&void 0!==d?d:null===(u=null==o?void 0:o.hooks)||void 0===u?void 0:u.beforeLoad)&&void 0!==p?p:null===(f=null===(m=this.options)||void 0===m?void 0:m.hooks)||void 0===f?void 0:f.beforeLoad,R=null!==(v=null!==(h=null==a?void 0:a.afterLoad)&&void 0!==h?h:null===(y=null==o?void 0:o.hooks)||void 0===y?void 0:y.afterLoad)&&void 0!==v?v:null===(E=null===(g=this.options)||void 0===g?void 0:g.hooks)||void 0===E?void 0:E.afterLoad,i?[4,this.resolveImportMap(e)]:[3,2]);case 1:e=n.sent(),n.label=2;case 2:C=document.createElement("script"),r&&(C.type="module"),C.src=e,C.onload=function(){R?T.handleHook(R,t).then(w.resolve).catch(w.reject):w.resolve()},C.onerror=w.reject,L?this.handleHook(L,t).then((function(){return document.body.appendChild(C)})).catch(w.reject):document.body.appendChild(C),n.label=3;case 3:return[2,this.registry.get(this.stripUrlProtocol(e))]}}))}))},e.prototype.addElement=function(e){var t;return this.registry.set(this.stripUrlProtocol(e),new Promise((function(e,r){return t={resolve:e,reject:r}}))),t},e.prototype.hasElement=function(e){return this.registry.has(this.stripUrlProtocol(e))},e.prototype.stripUrlProtocol=function(e){return e.replace(/https?:\/\//,"")},e.prototype.handleHook=function(e,t){try{return Promise.resolve(e(t))}catch(e){return Promise.reject(e)}},e.prototype.resolveImportMap=function(e){return o(this,void 0,void 0,(function(){var t;return n(this,(function(r){switch(r.label){case 0:return(t=window.System)?[4,t.prepareImport()]:[3,2];case 1:return r.sent(),e=t.resolve(e),[3,3];case 2:throw new Error(c+" - importMap feature depends on SystemJS library to be globally loaded but none was found, thus '"+e+"' can't be resolved. You should either load SystemJS or remove the importMap flag.");case 3:return[2,e]}}))}))},e}();d.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],d.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[s]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[a]}]}]},d.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new d(t.ɵɵinject(s),t.ɵɵinject(a,8))},token:d,providedIn:"root"});var u=function(){function e(e,t,r,o,n){this.vcr=e,this.template=t,this.elementsLoaderService=r,this.cfr=o,this.cdr=n,this.viewRef=null}return e.prototype.ngOnInit=function(){var e=this,t=this.template,r=t._declarationTContainer?t._declarationTContainer.tagName:t._def.element.template.nodes[0].element.name,o=this.elementsLoaderService.getElementConfig(r)||{},n=this.elementsLoaderService.options,i=o.loadingComponent||n.loadingComponent;if(this.loadingTemplateRef)this.vcr.createEmbeddedView(this.loadingTemplateRef);else if(i){var a=this.cfr.resolveComponentFactory(i);this.vcr.createComponent(a)}this.elementsLoaderService.loadElement(this.url,r,this.isModule,this.importMap,null==o?void 0:o.hooks).then((function(){return customElements.whenDefined(r)})).then((function(){e.vcr.clear(),e.viewRef=e.vcr.createEmbeddedView(e.template),e.cdr.markForCheck()})).catch((function(){e.vcr.clear();var t=o.errorComponent||n.errorComponent;if(e.errorTemplateRef)e.vcr.createEmbeddedView(e.errorTemplateRef),e.cdr.markForCheck();else if(t){var i=e.cfr.resolveComponentFactory(t);e.vcr.createComponent(i),e.cdr.markForCheck()}else console.error("@angular-extensions/elements - Loading of element <"+r+'> failed, please provide <ng-template #error>Loading failed...</ng-template> and reference it in *axLazyElement="errorTemplate: error" to display customized error message in place of element')}))},e.prototype.destroyEmbeddedView=function(){this.viewRef&&!this.viewRef.destroyed&&(this.viewRef.detach(),this.viewRef.destroy(),this.viewRef=null)},e}();u.decorators=[{type:t.Directive,args:[{selector:"[axLazyElement]"}]}],u.ctorParameters=function(){return[{type:t.ViewContainerRef},{type:t.TemplateRef},{type:d},{type:t.ComponentFactoryResolver},{type:t.ChangeDetectorRef}]},u.propDecorators={url:[{type:t.Input,args:["axLazyElement"]}],loadingTemplateRef:[{type:t.Input,args:["axLazyElementLoadingTemplate"]}],errorTemplateRef:[{type:t.Input,args:["axLazyElementErrorTemplate"]}],isModule:[{type:t.Input,args:["axLazyElementModule"]}],importMap:[{type:t.Input,args:["axLazyElementImportMap"]}]};var p="@angular-extensions/elements",m=function(){function e(e,t,r,o,n,i,a){this.document=e,this.renderer=t,this.vcr=r,this.cfr=o,this.cdr=n,this.template=i,this.elementsLoaderService=a,this.viewRef=null}return e.prototype.ngOnInit=function(){var e=this;if(!this.tag||0===this.tag.length||!this.tag.includes("-"))throw new Error(p+' - Valid tag has to be specified when using *axLazyElementDynamic directive (use *axLazyElementDynamic="\'some-tag\'"), got: "'+this.tag+'"');var t=this.elementsLoaderService.getElementConfig(this.tag)||{},r=this.elementsLoaderService.options,o=t.loadingComponent||r.loadingComponent;if(this.loadingTemplateRef)this.vcr.createEmbeddedView(this.loadingTemplateRef);else if(o){var n=this.cfr.resolveComponentFactory(o);this.vcr.createComponent(n)}this.elementsLoaderService.loadElement(this.url,this.tag,this.isModule,this.importMap,null==t?void 0:t.hooks).then((function(){return customElements.whenDefined(e.tag)})).then((function(){e.vcr.clear();var t=e.renderer.createElement;e.renderer.createElement=function(t,r){return"ax-lazy-element"===t&&(t=e.tag),e.document.createElement(t)},e.viewRef=e.vcr.createEmbeddedView(e.template),e.renderer.createElement=t,e.cdr.markForCheck()})).catch((function(o){var n=t.errorComponent||r.errorComponent;if(e.vcr.clear(),e.errorTemplateRef)e.vcr.createEmbeddedView(e.errorTemplateRef),e.cdr.markForCheck();else if(n){var i=e.cfr.resolveComponentFactory(n);e.vcr.createComponent(i),e.cdr.markForCheck()}else console.error(p+" - Loading of element <"+e.tag+'> failed, please provide <ng-template #error>Loading failed...</ng-template> and reference it in *axLazyElementDynamic="errorTemplate: error" to display customized error message in place of element\n\n',o)}))},e.prototype.destroyEmbeddedView=function(){this.viewRef&&!this.viewRef.destroyed&&(this.viewRef.detach(),this.viewRef.destroy(),this.viewRef=null)},e}();function f(e){if(e)throw new TypeError("LazyElementsModule.forRoot() called twice. Feature modules should use LazyElementsModule.forFeature() instead.");return"LazyElementsModule.forRoot() multiple execution guard"}m.decorators=[{type:t.Directive,args:[{selector:"[axLazyElementDynamic]"}]}],m.ctorParameters=function(){return[{type:Document,decorators:[{type:t.Inject,args:[r.DOCUMENT]}]},{type:t.Renderer2},{type:t.ViewContainerRef},{type:t.ComponentFactoryResolver},{type:t.ChangeDetectorRef},{type:t.TemplateRef},{type:d}]},m.propDecorators={tag:[{type:t.Input,args:["axLazyElementDynamic"]}],url:[{type:t.Input,args:["axLazyElementDynamicUrl"]}],loadingTemplateRef:[{type:t.Input,args:["axLazyElementDynamicLoadingTemplate"]}],errorTemplateRef:[{type:t.Input,args:["axLazyElementDynamicErrorTemplate"]}],isModule:[{type:t.Input,args:["axLazyElementDynamicModule"]}],importMap:[{type:t.Input,args:["axLazyElementDynamicImportMap"]}]};var h=function(){function e(e,t,r){t&&t.length&&t.filter((function(e){return e.some((function(e){return!e.isAdded}))})).forEach((function(t){return e.addConfigs(t)}))}return e.forRoot=function(r){return{ngModule:e,providers:[{provide:i,useValue:r&&r.elementConfigs?r.elementConfigs:[],multi:!0},{provide:a,useValue:r.rootOptions?r.rootOptions:{}},{provide:l,useFactory:f,deps:[[a,new t.Optional,new t.SkipSelf]]}]}},e.forFeature=function(t){return{ngModule:e,providers:[{provide:i,useValue:t&&t.elementConfigs?t.elementConfigs:[],multi:!0}]}},e}();h.decorators=[{type:t.NgModule,args:[{declarations:[u,m],imports:[r.CommonModule],exports:[u,m],providers:[]}]}],h.ctorParameters=function(){return[{type:d},{type:Array,decorators:[{type:t.Optional},{type:t.Inject,args:[i]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[l]}]}]},e.LAZY_ELEMENTS_REGISTRY=s,e.LAZY_ELEMENT_CONFIGS=i,e.LAZY_ELEMENT_ROOT_GUARD=l,e.LAZY_ELEMENT_ROOT_OPTIONS=a,e.LazyElementDirective=u,e.LazyElementDynamicDirective=m,e.LazyElementsLoaderService=d,e.LazyElementsModule=h,e.createLazyElementRootGuard=f,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-extensions-elements.umd.min.js.map