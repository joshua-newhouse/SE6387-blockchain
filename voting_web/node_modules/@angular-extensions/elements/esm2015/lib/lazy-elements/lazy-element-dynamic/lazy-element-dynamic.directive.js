/**
 * @fileoverview added by tsickle
 * Generated from: lib/lazy-elements/lazy-element-dynamic/lazy-element-dynamic.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, ComponentFactoryResolver, Directive, Inject, Input, Renderer2, TemplateRef, ViewContainerRef, } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { LazyElementsLoaderService, } from '../lazy-elements-loader.service';
/** @type {?} */
const LOG_PREFIX = '@angular-extensions/elements';
/**
 * \@dynamic
 */
export class LazyElementDynamicDirective {
    /**
     * @param {?} document
     * @param {?} renderer
     * @param {?} vcr
     * @param {?} cfr
     * @param {?} cdr
     * @param {?} template
     * @param {?} elementsLoaderService
     */
    constructor(document, renderer, vcr, cfr, cdr, template, elementsLoaderService) {
        this.document = document;
        this.renderer = renderer;
        this.vcr = vcr;
        this.cfr = cfr;
        this.cdr = cdr;
        this.template = template;
        this.elementsLoaderService = elementsLoaderService;
        // tslint:disable-line:no-input-rename
        this.viewRef = null;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!this.tag || this.tag.length === 0 || !this.tag.includes('-')) {
            throw new Error(`${LOG_PREFIX} - Valid tag has to be specified when using *axLazyElementDynamic directive (use *axLazyElementDynamic="'some-tag'"), got: "${this.tag}"`);
        }
        /** @type {?} */
        const elementConfig = this.elementsLoaderService.getElementConfig(this.tag) ||
            ((/** @type {?} */ ({})));
        /** @type {?} */
        const options = this.elementsLoaderService.options;
        /** @type {?} */
        const loadingComponent = elementConfig.loadingComponent || options.loadingComponent;
        if (this.loadingTemplateRef) {
            this.vcr.createEmbeddedView(this.loadingTemplateRef);
        }
        else if (loadingComponent) {
            /** @type {?} */
            const factory = this.cfr.resolveComponentFactory(loadingComponent);
            this.vcr.createComponent(factory);
        }
        this.elementsLoaderService
            .loadElement(this.url, this.tag, this.isModule, this.importMap, elementConfig === null || elementConfig === void 0 ? void 0 : elementConfig.hooks)
            .then((/**
         * @return {?}
         */
        () => customElements.whenDefined(this.tag)))
            .then((/**
         * @return {?}
         */
        () => {
            this.vcr.clear();
            /** @type {?} */
            const originalCreateElement = this.renderer.createElement;
            this.renderer.createElement = (/**
             * @param {?} name
             * @param {?} namespace
             * @return {?}
             */
            (name, namespace) => {
                if (name === 'ax-lazy-element') {
                    name = this.tag;
                }
                return this.document.createElement(name);
            });
            this.viewRef = this.vcr.createEmbeddedView(this.template);
            this.renderer.createElement = originalCreateElement;
            this.cdr.markForCheck();
        }))
            .catch((/**
         * @param {?} error
         * @return {?}
         */
        (error) => {
            /** @type {?} */
            const errorComponent = elementConfig.errorComponent || options.errorComponent;
            this.vcr.clear();
            if (this.errorTemplateRef) {
                this.vcr.createEmbeddedView(this.errorTemplateRef);
                this.cdr.markForCheck();
            }
            else if (errorComponent) {
                /** @type {?} */
                const factory = this.cfr.resolveComponentFactory(errorComponent);
                this.vcr.createComponent(factory);
                this.cdr.markForCheck();
            }
            else {
                console.error(`${LOG_PREFIX} - Loading of element <${this.tag}> failed, please provide <ng-template #error>Loading failed...</ng-template> and reference it in *axLazyElementDynamic="errorTemplate: error" to display customized error message in place of element\n\n`, error);
            }
        }));
    }
    /**
     * @return {?}
     */
    destroyEmbeddedView() {
        if (this.viewRef && !this.viewRef.destroyed) {
            this.viewRef.detach();
            this.viewRef.destroy();
            this.viewRef = null;
        }
    }
}
LazyElementDynamicDirective.decorators = [
    { type: Directive, args: [{
                selector: '[axLazyElementDynamic]',
            },] }
];
/** @nocollapse */
LazyElementDynamicDirective.ctorParameters = () => [
    { type: Document, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: Renderer2 },
    { type: ViewContainerRef },
    { type: ComponentFactoryResolver },
    { type: ChangeDetectorRef },
    { type: TemplateRef },
    { type: LazyElementsLoaderService }
];
LazyElementDynamicDirective.propDecorators = {
    tag: [{ type: Input, args: ['axLazyElementDynamic',] }],
    url: [{ type: Input, args: ['axLazyElementDynamicUrl',] }],
    loadingTemplateRef: [{ type: Input, args: ['axLazyElementDynamicLoadingTemplate',] }],
    errorTemplateRef: [{ type: Input, args: ['axLazyElementDynamicErrorTemplate',] }],
    isModule: [{ type: Input, args: ['axLazyElementDynamicModule',] }],
    importMap: [{ type: Input, args: ['axLazyElementDynamicImportMap',] }]
};
if (false) {
    /** @type {?} */
    LazyElementDynamicDirective.prototype.tag;
    /** @type {?} */
    LazyElementDynamicDirective.prototype.url;
    /** @type {?} */
    LazyElementDynamicDirective.prototype.loadingTemplateRef;
    /** @type {?} */
    LazyElementDynamicDirective.prototype.errorTemplateRef;
    /** @type {?} */
    LazyElementDynamicDirective.prototype.isModule;
    /** @type {?} */
    LazyElementDynamicDirective.prototype.importMap;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.viewRef;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.document;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.vcr;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.cfr;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.cdr;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.template;
    /**
     * @type {?}
     * @private
     */
    LazyElementDynamicDirective.prototype.elementsLoaderService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF6eS1lbGVtZW50LWR5bmFtaWMuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Ii9ob21lL3RyYXZpcy9idWlsZC9hbmd1bGFyLWV4dGVuc2lvbnMvZWxlbWVudHMvcHJvamVjdHMvZWxlbWVudHMvc3JjLyIsInNvdXJjZXMiOlsibGliL2xhenktZWxlbWVudHMvbGF6eS1lbGVtZW50LWR5bmFtaWMvbGF6eS1lbGVtZW50LWR5bmFtaWMuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUNMLGlCQUFpQixFQUNqQix3QkFBd0IsRUFDeEIsU0FBUyxFQUVULE1BQU0sRUFDTixLQUFLLEVBRUwsU0FBUyxFQUNULFdBQVcsRUFDWCxnQkFBZ0IsR0FDakIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRTNDLE9BQU8sRUFFTCx5QkFBeUIsR0FDMUIsTUFBTSxpQ0FBaUMsQ0FBQzs7TUFFbkMsVUFBVSxHQUFHLDhCQUE4Qjs7OztBQU1qRCxNQUFNLE9BQU8sMkJBQTJCOzs7Ozs7Ozs7O0lBY3RDLFlBQzRCLFFBQWtCLEVBQ3BDLFFBQW1CLEVBQ25CLEdBQXFCLEVBQ3JCLEdBQTZCLEVBQzdCLEdBQXNCLEVBQ3RCLFFBQTBCLEVBQzFCLHFCQUFnRDtRQU45QixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ3BDLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsUUFBRyxHQUFILEdBQUcsQ0FBa0I7UUFDckIsUUFBRyxHQUFILEdBQUcsQ0FBMEI7UUFDN0IsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDdEIsYUFBUSxHQUFSLFFBQVEsQ0FBa0I7UUFDMUIsMEJBQXFCLEdBQXJCLHFCQUFxQixDQUEyQjs7UUFUbEQsWUFBTyxHQUF5QixJQUFJLENBQUM7SUFVMUMsQ0FBQzs7OztJQUVKLFFBQVE7UUFDTixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxJQUFJLENB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InNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIERpcmVjdGl2ZSxcbiAgRW1iZWRkZWRWaWV3UmVmLFxuICBJbmplY3QsXG4gIElucHV0LFxuICBPbkluaXQsXG4gIFJlbmRlcmVyMixcbiAgVGVtcGxhdGVSZWYsXG4gIFZpZXdDb250YWluZXJSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuXG5pbXBvcnQge1xuICBFbGVtZW50Q29uZmlnLFxuICBMYXp5RWxlbWVudHNMb2FkZXJTZXJ2aWNlLFxufSBmcm9tICcuLi9sYXp5LWVsZW1lbnRzLWxvYWRlci5zZXJ2aWNlJztcblxuY29uc3QgTE9HX1BSRUZJWCA9ICdAYW5ndWxhci1leHRlbnNpb25zL2VsZW1lbnRzJztcblxuLyoqIEBkeW5hbWljICovXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbYXhMYXp5RWxlbWVudER5bmFtaWNdJyxcbn0pXG5leHBvcnQgY2xhc3MgTGF6eUVsZW1lbnREeW5hbWljRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCdheExhenlFbGVtZW50RHluYW1pYycpIHRhZzogc3RyaW5nO1xuICBASW5wdXQoJ2F4TGF6eUVsZW1lbnREeW5hbWljVXJsJykgdXJsOiBzdHJpbmc7IC8vIHRzbGludDpkaXNhYmxlLWxpbmU6bm8taW5wdXQtcmVuYW1lXG4gIEBJbnB1dCgnYXhMYXp5RWxlbWVudER5bmFtaWNMb2FkaW5nVGVtcGxhdGUnKSBsb2FkaW5nVGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPFxuICAgIGFueVxuICA+OyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLWlucHV0LXJlbmFtZVxuICBASW5wdXQoJ2F4TGF6eUVsZW1lbnREeW5hbWljRXJyb3JUZW1wbGF0ZScpIGVycm9yVGVtcGxhdGVSZWY6IFRlbXBsYXRlUmVmPFxuICAgIGFueVxuICA+OyAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLWlucHV0LXJlbmFtZVxuICBASW5wdXQoJ2F4TGF6eUVsZW1lbnREeW5hbWljTW9kdWxlJykgaXNNb2R1bGU6IGJvb2xlYW4gfCB1bmRlZmluZWQ7IC8vIHRzbGludDpkaXNhYmxlLWxpbmU6bm8taW5wdXQtcmVuYW1lXG4gIEBJbnB1dCgnYXhMYXp5RWxlbWVudER5bmFtaWNJbXBvcnRNYXAnKSBpbXBvcnRNYXA6IGJvb2xlYW4gfCB1bmRlZmluZWQ7IC8vIHRzbGludDpkaXNhYmxlLWxpbmU6bm8taW5wdXQtcmVuYW1lXG5cbiAgcHJpdmF0ZSB2aWV3UmVmOiBFbWJlZGRlZFZpZXdSZWY8YW55PiA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogRG9jdW1lbnQsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgdmNyOiBWaWV3Q29udGFpbmVyUmVmLFxuICAgIHByaXZhdGUgY2ZyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4sXG4gICAgcHJpdmF0ZSBlbGVtZW50c0xvYWRlclNlcnZpY2U6IExhenlFbGVtZW50c0xvYWRlclNlcnZpY2VcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICghdGhpcy50YWcgfHwgdGhpcy50YWcubGVuZ3RoID09PSAwIHx8ICF0aGlzLnRhZy5pbmNsdWRlcygnLScpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGAke0xPR19QUkVGSVh9IC0gVmFsaWQgdGFnIGhhcyB0byBiZSBzcGVjaWZpZWQgd2hlbiB1c2luZyAqYXhMYXp5RWxlbWVudER5bmFtaWMgZGlyZWN0aXZlICh1c2UgKmF4TGF6eUVsZW1lbnREeW5hbWljPVwiJ3NvbWUtdGFnJ1wiKSwgZ290OiBcIiR7dGhpcy50YWd9XCJgXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGVsZW1lbnRDb25maWcgPVxuICAgICAgdGhpcy5lbGVtZW50c0xvYWRlclNlcnZpY2UuZ2V0RWxlbWVudENvbmZpZyh0aGlzLnRhZykgfHxcbiAgICAgICh7fSBhcyBFbGVtZW50Q29uZmlnKTtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5lbGVtZW50c0xvYWRlclNlcnZpY2Uub3B0aW9ucztcbiAgICBjb25zdCBsb2FkaW5nQ29tcG9uZW50ID1cbiAgICAgIGVsZW1lbnRDb25maWcubG9hZGluZ0NvbXBvbmVudCB8fCBvcHRpb25zLmxvYWRpbmdDb21wb25lbnQ7XG5cbiAgICBpZiAodGhpcy5sb2FkaW5nVGVtcGxhdGVSZWYpIHtcbiAgICAgIHRoaXMudmNyLmNyZWF0ZUVtYmVkZGVkVmlldyh0aGlzLmxvYWRpbmdUZW1wbGF0ZVJlZik7XG4gICAgfSBlbHNlIGlmIChsb2FkaW5nQ29tcG9uZW50KSB7XG4gICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkobG9hZGluZ0NvbXBvbmVudCk7XG4gICAgICB0aGlzLnZjci5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XG4gICAgfVxuXG4gICAgdGhpcy5lbGVtZW50c0xvYWRlclNlcnZpY2VcbiAgICAgIC5sb2FkRWxlbWVudChcbiAgICAgICAgdGhpcy51cmwsXG4gICAgICAgIHRoaXMudGFnLFxuICAgICAgICB0aGlzLmlzTW9kdWxlLFxuICAgICAgICB0aGlzLmltcG9ydE1hcCxcbiAgICAgICAgZWxlbWVudENvbmZpZz8uaG9va3NcbiAgICAgIClcbiAgICAgIC50aGVuKCgpID0+IGN1c3RvbUVsZW1lbnRzLndoZW5EZWZpbmVkKHRoaXMudGFnKSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgdGhpcy52Y3IuY2xlYXIoKTtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxDcmVhdGVFbGVtZW50ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50O1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQgPSAobmFtZTogc3RyaW5nLCBuYW1lc3BhY2U6IHN0cmluZykgPT4ge1xuICAgICAgICAgIGlmIChuYW1lID09PSAnYXgtbGF6eS1lbGVtZW50Jykge1xuICAgICAgICAgICAgbmFtZSA9IHRoaXMudGFnO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWUpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnZpZXdSZWYgPSB0aGlzLnZjci5jcmVhdGVFbWJlZGRlZFZpZXcodGhpcy50ZW1wbGF0ZSk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCA9IG9yaWdpbmFsQ3JlYXRlRWxlbWVudDtcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zdCBlcnJvckNvbXBvbmVudCA9XG4gICAgICAgICAgZWxlbWVudENvbmZpZy5lcnJvckNvbXBvbmVudCB8fCBvcHRpb25zLmVycm9yQ29tcG9uZW50O1xuICAgICAgICB0aGlzLnZjci5jbGVhcigpO1xuICAgICAgICBpZiAodGhpcy5lcnJvclRlbXBsYXRlUmVmKSB7XG4gICAgICAgICAgdGhpcy52Y3IuY3JlYXRlRW1iZWRkZWRWaWV3KHRoaXMuZXJyb3JUZW1wbGF0ZVJlZik7XG4gICAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyb3JDb21wb25lbnQpIHtcbiAgICAgICAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5jZnIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoZXJyb3JDb21wb25lbnQpO1xuICAgICAgICAgIHRoaXMudmNyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcbiAgICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICAgYCR7TE9HX1BSRUZJWH0gLSBMb2FkaW5nIG9mIGVsZW1lbnQgPCR7dGhpcy50YWd9PiBmYWlsZWQsIHBsZWFzZSBwcm92aWRlIDxuZy10ZW1wbGF0ZSAjZXJyb3I+TG9hZGluZyBmYWlsZWQuLi48L25nLXRlbXBsYXRlPiBhbmQgcmVmZXJlbmNlIGl0IGluICpheExhenlFbGVtZW50RHluYW1pYz1cImVycm9yVGVtcGxhdGU6IGVycm9yXCIgdG8gZGlzcGxheSBjdXN0b21pemVkIGVycm9yIG1lc3NhZ2UgaW4gcGxhY2Ugb2YgZWxlbWVudFxcblxcbmAsXG4gICAgICAgICAgICBlcnJvclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgZGVzdHJveUVtYmVkZGVkVmlldygpIHtcbiAgICBpZiAodGhpcy52aWV3UmVmICYmICF0aGlzLnZpZXdSZWYuZGVzdHJveWVkKSB7XG4gICAgICB0aGlzLnZpZXdSZWYuZGV0YWNoKCk7XG4gICAgICB0aGlzLnZpZXdSZWYuZGVzdHJveSgpO1xuICAgICAgdGhpcy52aWV3UmVmID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==